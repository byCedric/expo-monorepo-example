name: deploy example

on:
  push:
    branches: [main]

jobs:
  deploy:
    name: Deploy
    outputs:
      deployment: ${{ steps.deploy.outputs.deployment }}
    steps:
      - name: ğŸ— Setup pnpm
        run: npm install --global pnpm@9
      - name: ğŸ— Setup repository
        uses: eas/checkout
      - name: ğŸ“¦ Install dependencies
        run: pnpm install
      - name: ğŸ‘· Build example packages
        run: pnpm run -w build:example
      - name: ğŸŒ Build example for web only
        run: pnpm run build --platform web
        working_directory: apps/example
      - name: ğŸš€ Deploy example
        run: set-output deployment "$(npx eas-cli deploy --non-interactive --json --export-dir ./build --alias staging)"
        working_directory: apps/example
        id: deploy
  promote:
    name: Promote to production
    needs: [deploy]
    steps:
      - name: ğŸ— Setup repository
        uses: eas/checkout
      - name: ğŸ§‘â€ğŸ“ Promote deployment
        run: npx eas-cli deploy:promote --production --id "${{ fromJSON(needs.deploy.outputs.deployment).identifier }}"
